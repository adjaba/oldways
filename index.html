<!DOCTYPE html>
<html>
<style>
h1 { 
  font-family: Papyrus,fantasy; 
  font-size: 50px;
  color: #654321;
  text-align: center;
}
/* Fixed sidenav, full height */
.sidenav {
  height: 100%;
  width: 180px;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #362311;
  overflow-x: hidden;
  padding-top: 20px;
}
/* Style the sidenav links and the dropdown button */
.sidenav a {
  padding: 6px 8px 6px 16px;
  display: block;
  border: none;
  background: none;
  width: 100%;
  cursor: pointer;
  outline: none;
}
/* On mouse-over */
.active, .accordion:hover {
  color: #FFF2EB;
}
.accordion:after {
  color: #818181;
  content: "" attr(id) " \25B8"; 
  font-size: 20px;
}
  
.active:after {
  content: "" attr(id) "  \25BE";
  color: #FFF2EB;
  font-size: 20px;
}
 
.accordion {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 20px;
  color: #818181;
  display: block;
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  cursor: pointer;
  outline: none;
  font-family: Optima; 
  transition: 0.4s;
}
.boxed {
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  float: left;
  width: 225px;
  height: 225px; 
   margin: 10px;
/*     margin-left: 26px;
    margin-top: 10px; */
    padding: 5px;
    border: 2px solid;
    border-color: #654321;
	  
}
.boxed:hover {
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
}
.panel {
  padding: 0 18px;
  display: none;
  background-color: #362311;
  font-family: Optima; 
  font-size: 18px;
  color: #FCFCFC;
  overflow: hidden;
}
  
#heading {
  color: #FFF2EB;
  text-align: center;
  font-family: Optima; 
  font-size: 25px;
}
/* Main content */
.main {
  margin-left: 200px; /* Same as the width of the sidenav */
  font-size: 20px; /* Increased text to enable scrolling */
  padding: 0px 10px;
}
.card {
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  float: left;
  width: 80%;
  height: auto;
  border-radius: 5px;
  background-color: #FCFCFC;
}
.card:hover {
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
}
img {
  border-radius: 5px 5px 0 0;
}
.container {
  padding: 20px 0px;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  font-family: Optima; 
  color: #362311; 
}
.jumping-dots span {
  position: relative;
  bottom: 0px;
  -webkit-animation: jump 1500ms infinite;
  animation: jump 2s infinite;
}
.jumping-dots .dot-1{
  -webkit-animation-delay: 200ms;
  animation-delay: 200ms;
}
.jumping-dots .dot-2{
  -webkit-animation-delay: 400ms;
  animation-delay: 400ms;
}
.jumping-dots .dot-3{
  -webkit-animation-delay: 600ms;
  animation-delay: 600ms;
}
@-webkit-keyframes jump {
  0%   {bottom: 0px;}
  20%  {bottom: 30px;}
  40%  {bottom: 0px;}
}
@keyframes jump {
  0%   {bottom: 0px;}
  20%  {bottom: 30px;}
  40%  {bottom: 0px;}
}
.tab {
  overflow: hidden;
  border: 1px solid #FFF2EB;
  border-radius: 5px;
  background-color: #654321;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
  color: #FFFFFF;
  font-family: Optima;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #4f3419;
}

/* Create an active/current tablink class */
.tab button.actively {
  background-color: #362311;
}

.rightpanel {
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  width: 17%;
  height: auto;
  border-radius: 5px;
  background-color: #fffbed;
  float: right;
  text-align: center;
	
}

</style>
<head>
  <meta charset="utf-8"/>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://d3js.org/queue.v1.min.js"></script>
</head>
<body style="background-image:url('scroll_background.png')" margin:"0px"> 
<div id="loader" style="display:block">
  <h1 style="padding-top:150px"> loading ...</h1> 
  <center>
  <span class="jumping-dots">
    <span class="dot-1"><img src="cherries.png" width="166" height="196"></span>
    <span class="dot-2"><img src="grapes.png" width="173" height="285"></span>
    <span class="dot-3"><img src="orange.png" width="140" height="120"></span>
  </span>
  </center>
  <h1 style="padding-top:50px"> please be patient. </h1> 
</div>

<div id="mainpage" style="display:none">
  <div class="sidenav">
    <div id="heading"> See Survey Results </div>
    <br>
    <button class="accordion" id="class"></button>
    <div class="panel">
    <input type="checkbox" name="class1" value="african">
    <label for="vehicle1">African</label><br>
    <input type="checkbox" name="class2" value="middleeastern" checked>
    <label for="vehicle2">Middle Eastern</label><br>
    <input type="checkbox" name="class3" value="asian">
    <label for="vehicle3">Asian</label>
    </div>  
    <br>
    <button class="accordion" id="teacher"></button>
    <div class="panel">
    <input type="checkbox" name="teacher1" value="smith">
    <label for="vehicle1"> Mr. Smith</label><br>
    <input type="checkbox" name="teacher2" value="brown">
    <label for="vehicle2"> Mr. Brown</label><br>
    <input type="checkbox" name="teacher3" value="rogers" checked>
    <label for="vehicle3"> Ms. Rogers</label>
    </div>
    <br>
    <button class="accordion" id="year"></button>
    <div class="panel">
     <input type="checkbox" name="year1" value="2019" checked>
    <label for="vehicle1"> 2019</label><br>
    <input type="checkbox" name="year2" value="2018">
    <label for="vehicle2"> 2018</label><br>
    <input type="checkbox" name="year3" value="2017">
    <label for="vehicle3"> 2017</label>
    </div>
   </div>
  <div class="main">
    <h1>oldways portal</h1>
  <center>
  <div class="card">
    <div class="tab">
      <button class="tablinks" onclick="all_statistics(event, 'cooking')"> Cooking & Lifestyle </button>
      <button class="tablinks" onclick="all_statistics(event, 'physical')"> Physical Improvement </button>
      <button class="tablinks" onclick="all_statistics(event, 'stats')"> Overall Statistics </button>
    </div>
    <div class="container" id="container">
    </div>
  
  </div>
  
  
  </center>
  <div class = "rightpanel" id = "rightpanel">
  </div>
 
  </div>
</div>
</body>
<script> 
  function changedisplays() {
    document.getElementById('mainpage').style.display='block';
    document.getElementById('loader').style.display='none';
  }
var acc = document.getElementsByClassName("accordion");
var database;
var ogContainer = document.getElementById("container").innerHTML;
var oldContainer = ogContainer.innerHTML;
var i;
for (i = 0; i < acc.length; i++) {
  acc[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var panel = this.nextElementSibling;
    if (panel.style.display === "block") {
      panel.style.display = "none";      
    } else {
      panel.style.display = "block";
    }
  });
}
	function get_students(database){
		var text_to_add = "<br> <center> Number of Surveys: ";
		var circle = '<svg width = "12px" height = "10px" xmlns="http://www.w3.org/2000/svg"> <circle cx="5" cy="5" r="5" fill="black" /></svg>'
		var cur_students = database.filter((entry) => entry['Participant ID']).length
		text_to_add += "<b>" + cur_students + "</b> </center>"
		for (var i = 1; i < cur_students + 1; i++) {
			text_to_add += circle;
			if ( i % 15 == 0 ) {
				text_to_add += "<br>";
			}
		}
		document.getElementById("rightpanel").innerHTML = text_to_add;
	}
	function student_results(){
		document.getElementById("rightpanel").innerHTML = "changed? " + document.getElementById("rightpanel").innerHTML;
		
		// change the color to grey
		const rightpanel = d3.select("mainpage").select("main").select("rightpanel");
		rightpanel.selectAll("svg").selectAll("circle").style("fill", "red");
			
		console.log("changed svg?");
		
	}
  	function all_statistics(evt, tabName){
		function toPercent(fraction){
			return (fraction*100).toFixed(2)+"%"
		}
		
		function addToContainer(category_name, number){
			var box_start = "<div class = 'boxed' onmouseover='student_results()' onmouseout='get_students(database)'>"
			var box_end = "</div>"
			document.getElementById("container").innerHTML += box_start + category_name + "<br>" + number + box_end;
		}
		function isComplete(change){
			return ["âœ…", "ðŸ”»", "Remained Same","1", "0", "-1"].indexOf(change) >=0
		}
		var categories = ['Home Cooked', 'Greens', 'Whole Grains', 'Fruits', 'Exercise', 'Tubers', 'Beans', 'Herbs & Spices', 'Vegetarian'];
		var columns = categories.map((category) => category + '_Change');
		var box_start = "<div class = 'boxed'>"
		var box_end = "</div>"
		// document.getElementById("container").innerHTML += "<div class='boxed'>Test</div>"
		
		if (tabName == "cooking"){
			document.getElementById("container").innerHTML = "";
			categories.forEach(function (category){
				var column = category + '_Change';
				var numerator = database.filter((entry) => entry[column] === "âœ…" || entry[column] === "1").length;
				var denominator = database.filter((entry) => isComplete(entry[column])).length;
				    //numerator + database.filter((entry) => entry[column] === "ðŸ”»").length + database.filter((entry) => entry[column] === 'Remained Same').length;
				var result = denominator === 0? 0: numerator/denominator;
				addToContainer(category, toPercent(result));
	// 			document.getElementById("container").innerHTML += box_start + column + ":" + toPercent(result) + box_end;
			})
		}
		
		if (tabName == "stats"){	
			document.getElementById("container").innerHTML = "";
			var positiveImpactNum = 0;
			var positiveImpact = database.filter(function(entry){
				var positivelyImpacted = false;
				columns.forEach(function(column){
					positivelyImpacted = positivelyImpacted || entry[column] === "âœ…" || entry[column] === "1";
					positiveImpactNum += entry[column] === "âœ…" || entry[column] === "1"? 1: 0;
				})
				return positivelyImpacted
			})
		
		
		addToContainer("Number of categories positively impacted", positiveImpactNum);
// 		document.getElementById("container").innerHTML += box_start + "posImpactNum:"+ positiveImpactNum + "<br>" + "posImpact:" + positiveImpact.length + box_end;
		// document.getElementById("container").innerHTML += "posImpact:"+ positiveImpact.length + box_end;
		console.log("posImpactNum", positiveImpactNum)
		console.log("posImpact", positiveImpact.length);
		var totalWithPrePost = database.filter(function(entry){
			var complete = false;
			columns.forEach(function(column){
				complete = complete || isComplete(entry[column]);
					//entry[column] === "âœ…" || entry[column] === "ðŸ”»" || entry[column]=== "Remained Same";
			})
			return complete
		})
		var atLeastOnePos = positiveImpact.length;
		var totalComplete = totalWithPrePost.length;
		addToContainer("Percentage of people that were positively impacted in at least one category", toPercent(atLeastOnePos/totalComplete));
		addToContainer("Average number of categories positively impacted per person", (positiveImpactNum/totalComplete).toFixed(2));
		
// 		var to_add = box_start + "complete:" + totalComplete + "<br>";
// 		to_add += "show increase in at least one"+ totalComplete === 0? 0: atLeastOnePos/totalComplete;
// 		to_add += "<br>"
// 		to_add += "average increased categories"+ totalComplete === 0? 0: positiveImpactNum/totalComplete;
// 		to_add += box_end
// 		document.getElementById("container").innerHTML += to_add
		console.log("complete", totalComplete);
		console.log("show increase in at least one", totalComplete === 0? 0: atLeastOnePos/totalComplete); 
		console.log("average increased categories", totalComplete === 0? 0: positiveImpactNum/totalComplete);
		}
		if (tabName == "physical"){
			document.getElementById("container").innerHTML = "";
		function averageAndPercentage(change, pre, post, name){
			var complete = database.filter((entry) => isComplete(entry[change]));
			var total = 0;
			
			var count = database.filter(function(entry){
				total += entry[change]==="âœ…" || entry[change] === "1"? entry[pre]-entry[post]:0;
				return entry[change]==="âœ…" || entry[change] === "1"
			})
			
// 			to_add = ""
// 			to_add += box_start + change + "total: " + total + "<br>";
// 			to_add += change + "complete: " + complete.length + "<br>";
// 			to_add += change + "percent:" + complete.length === 0? 0: count.length/complete.length;
// 			to_add += box_end
// 			document.getElementById("container").innerHTML += to_add
			document.getElementById("container").innerHTML += box_start + name + "<br>" + "Percentage of people who improved<br>" + toPercent(count.length/complete.length) + "<br> Average improvement <br>" + (total/complete.length).toFixed(2) + box_end;
			console.log(change, 'total', total);
			console.log(change, 'complete', complete.length);
			console.log(change, 'percent', complete.length === 0? 0: count.length/complete.length);
		}
		
		averageAndPercentage('Weight_Change', 'Weight_Pre', 'Weight_Post', 'Weight');
		averageAndPercentage('WaistCircumference_Change', 'WaistCircumference_Pre', 'WaistCircumference_Post', 'Waist Circumference');
		averageAndPercentage('BP Category_Change', 'BP Category_Pre Num', 'BP Category_Post Num', 'BP Category');
		}
		tablinks = document.getElementsByClassName("tablinks");
		  for (i = 0; i < tablinks.length; i++) {
		    tablinks[i].className = tablinks[i].className.replace(" actively", "");
		  }
		evt.currentTarget.className += " actively";
		console.log('# of participants', database.filter((entry) => entry['Participant ID']).length);
		//document.getElementById("container").innerHTML += box_start + '# of participants:' + database.filter((entry) => entry['Participant ID']).length + box_end;
		//document.getElementById("container").innerHTML += "test";
	}
	queue()
		.defer(d3.csv, "atoah.csv")
		.await(loaddata);
	
	function loaddata(error, atoahstudent){
		//setTimeout("changedisplays()", 5000);
		setTimeout("changedisplays()", 100);
		database = atoahstudent;
		get_students(database);
	}
</script>
</html>
